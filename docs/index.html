<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>DSI - Group R</title><meta name="description" content="Documentation for DSI - Group R"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">DSI - Group R</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>DSI - Group R</h2></div><div class="tsd-panel tsd-typography"><a id="md:práctica-10---aplicación-cliente-servidor-para-coleccionistas-de-cartas-magic" class="tsd-anchor"></a><h1><a href="#md:práctica-10---aplicación-cliente-servidor-para-coleccionistas-de-cartas-magic">Práctica 10 - Aplicación cliente-servidor para coleccionistas de cartas Magic</a></h1><p><strong>Información de contacto:</strong></p>
<ul>
<li>Daniel Garvi Arvelo<ul>
<li>GitHub: <a href="https://github.com/GarviArveloDaniel">@GarviArveloDaniel</a></li>
<li>Email: <a href="mailto:alu0101501338@ull.edu.es">alu0101501338@ull.edu.es</a></li>
</ul>
</li>
</ul>
<a id="md:🌳-estructura-del-repositorio" class="tsd-anchor"></a><h2><a href="#md:🌳-estructura-del-repositorio">🌳 Estructura del repositorio</a></h2><pre><code class="language-shell"><span class="hl-0">.</span><br/><span class="hl-0">├──</span><span class="hl-1"> </span><span class="hl-2">Collections</span><br/><span class="hl-0">│</span><span class="hl-1">   </span><span class="hl-2">└──</span><span class="hl-1"> </span><span class="hl-2">edegre</span><br/><span class="hl-0">│</span><span class="hl-1">       </span><span class="hl-2">├──</span><span class="hl-1"> </span><span class="hl-3">1</span><br/><span class="hl-0">│</span><span class="hl-1">       </span><span class="hl-2">└──</span><span class="hl-1"> </span><span class="hl-3">2</span><br/><span class="hl-0">├──</span><span class="hl-1"> </span><span class="hl-2">package.json</span><br/><span class="hl-0">├──</span><span class="hl-1"> </span><span class="hl-2">package-lock.json</span><br/><span class="hl-0">├──</span><span class="hl-1"> </span><span class="hl-2">README.md</span><br/><span class="hl-0">├──</span><span class="hl-1"> </span><span class="hl-2">sonar-project.properties</span><br/><span class="hl-0">├──</span><span class="hl-1"> </span><span class="hl-2">src</span><br/><span class="hl-0">│</span><span class="hl-1">   </span><span class="hl-2">├──</span><span class="hl-1"> </span><span class="hl-2">ejercicio_pe</span><br/><span class="hl-0">│</span><span class="hl-1">   </span><span class="hl-2">│</span><span class="hl-1">   </span><span class="hl-2">├──</span><span class="hl-1"> </span><span class="hl-2">card_interface.ts</span><br/><span class="hl-0">│</span><span class="hl-1">   </span><span class="hl-2">│</span><span class="hl-1">   </span><span class="hl-2">├──</span><span class="hl-1"> </span><span class="hl-2">card.ts</span><br/><span class="hl-0">│</span><span class="hl-1">   </span><span class="hl-2">│</span><span class="hl-1">   </span><span class="hl-2">├──</span><span class="hl-1"> </span><span class="hl-2">card_utilities.ts</span><br/><span class="hl-0">│</span><span class="hl-1">   </span><span class="hl-2">│</span><span class="hl-1">   </span><span class="hl-2">└──</span><span class="hl-1"> </span><span class="hl-2">collection.ts</span><br/><span class="hl-0">│</span><span class="hl-1">   </span><span class="hl-2">└──</span><span class="hl-1"> </span><span class="hl-2">magic_app</span><br/><span class="hl-0">│</span><span class="hl-1">       </span><span class="hl-2">├──</span><span class="hl-1"> </span><span class="hl-2">card_interface.ts</span><br/><span class="hl-0">│</span><span class="hl-1">       </span><span class="hl-2">├──</span><span class="hl-1"> </span><span class="hl-2">card_utilities.ts</span><br/><span class="hl-0">│</span><span class="hl-1">       </span><span class="hl-2">├──</span><span class="hl-1"> </span><span class="hl-2">client</span><br/><span class="hl-0">│</span><span class="hl-1">       </span><span class="hl-2">│</span><span class="hl-1">   </span><span class="hl-2">└──</span><span class="hl-1"> </span><span class="hl-2">client.ts</span><br/><span class="hl-0">│</span><span class="hl-1">       </span><span class="hl-2">└──</span><span class="hl-1"> </span><span class="hl-2">server</span><br/><span class="hl-0">│</span><span class="hl-1">           </span><span class="hl-2">├──</span><span class="hl-1"> </span><span class="hl-2">collection.ts</span><br/><span class="hl-0">│</span><span class="hl-1">           </span><span class="hl-2">├──</span><span class="hl-1"> </span><span class="hl-2">request_event_emitter.ts</span><br/><span class="hl-0">│</span><span class="hl-1">           </span><span class="hl-2">└──</span><span class="hl-1"> </span><span class="hl-2">server.ts</span><br/><span class="hl-0">├──</span><span class="hl-1"> </span><span class="hl-2">tests</span><br/><span class="hl-0">│</span><span class="hl-1">   </span><span class="hl-2">├──</span><span class="hl-1"> </span><span class="hl-2">tests_magic_app</span><br/><span class="hl-0">│</span><span class="hl-1">   </span><span class="hl-2">│</span><span class="hl-1">   </span><span class="hl-2">└──</span><span class="hl-1"> </span><span class="hl-2">magic_app.spec.ts</span><br/><span class="hl-0">│</span><span class="hl-1">   </span><span class="hl-2">└──</span><span class="hl-1"> </span><span class="hl-2">tests_pe_magic_app</span><br/><span class="hl-0">│</span><span class="hl-1">       </span><span class="hl-2">└──</span><span class="hl-1"> </span><span class="hl-2">magic_app_pe.spec.ts</span><br/><span class="hl-0">└──</span><span class="hl-1"> </span><span class="hl-2">tsconfig.json</span><br/><br/><span class="hl-0">10</span><span class="hl-1"> </span><span class="hl-2">directories,</span><span class="hl-1"> </span><span class="hl-3">19</span><span class="hl-1"> </span><span class="hl-2">files</span>
</code><button>Copy</button></pre>
<a id="md:📚introducción" class="tsd-anchor"></a><h2><a href="#md:📚introducción">📚Introducción</a></h2><p>En esta práctica partimos de la práctica 9, y debemos modificarla para implementar la técnica modelo servidor, donde el cliente se encarga de recoger los datos introducidos por el usuario y enviarlos al servidor, y el servidor se encarga de realizar las operaciones correspondientes y devolver una respuesta.</p>
<a id="md:📋tareas-previas" class="tsd-anchor"></a><h2><a href="#md:📋tareas-previas">📋Tareas Previas</a></h2><p>Al igual que en prácticas anteriores, en primer lugar acepto la tarea de github Classroom para poder acceder al repositorio, realizo la misma configuración que en la práctica anteior y además instalo los paquetes <code>chalk</code> y <code>yargs</code>.</p>
<a id="md:enunciado" class="tsd-anchor"></a><h2><a href="#md:enunciado">Enunciado</a></h2><p>Debemos diseñar una aplicación para coleccionistas de cartas magic. La aplicación, diseñada para ser utilizada exclusivamente desde la línea de comandos, permitirá a múltiples usuarios interactuar con sus respectivas colecciones, ofreciendo funciones para añadir, modificar, eliminar, listar y mostrar información detallada de las cartas. Cada carta se describirá con atributos como ID único, nombre, coste de maná, color, tipo, rareza, texto de reglas, fuerza/resistencia (en caso de ser criatura), marcas de lealtad (para Planeswalkers) y valor de mercado. Antes de añadir o modificar una carta, se realizarán verificaciones para evitar duplicados o errores, y al listar las cartas, se utilizará el paquete chalk para mostrar los colores correspondientes. Las cartas se almacenarán como archivos JSON individuales en un directorio nombrado según el usuario, utilizando la API asíncrona de Node.js para el manejo de ficheros.</p>
<p>Además, se implementará un modelo cliente servidor:</p>
<p>Toda la lógica asociada a la gestión del sistema de ficheros tendrá que estar implementada en el lado del servidor. El servidor deberá ser capaz de procesar una petición. En primer lugar, deberá ser capaz de identificar el tipo de petición que ha recibido desde un cliente para, seguidamente, llevar a cabo las comprobaciones y operaciones necesarias con el sistema de ficheros. Además, deberá ser capaz de construir y enviar un mensaje de respuesta al cliente, el cual puede ser satisfactorio o no. Una vez enviado dicho mensaje, deberá cerrar el lado cliente del socket.</p>
<p>Toda la lógica asociada al paso de parámetros desde línea de comandos y su procesamiento mediante yargs tendrá que estar implementada en el lado del cliente. El cliente deberá ser capaz de enviar una petición al servidor. Además, deberá ser capaz de recibir una respuesta del servidor y procesarla. Por ejemplo, si el cliente ha solicitado al servidor la lectura de una carta concreta y el servidor ha respondido satisfactoriamente (porque la carta solicitada existe), dicha respuesta contendrá la información de la carta que se ha leído. El cliente deberá mostrar la información recibida en la respuesta por la consola utilizando chalk.</p>
<a id="md:implementación" class="tsd-anchor"></a><h2><a href="#md:implementación">Implementación</a></h2><a id="md:implementación-card" class="tsd-anchor"></a><h3><a href="#md:implementación-card">Implementación Card</a></h3><p>Se desarrolla la clase <code>Card</code> que a su vez implementa la interfaz <code>CardInterface</code> que lista todos los atributos que debe poseer una carta Magic, además, se crean una serie de enums <code>Color</code>, <code>CardType</code> y <code>Rarity</code> que limitan las opciones de ciertos atributos.</p>
<pre><code class="language-ts"><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-6">Card</span><span class="hl-1"> </span><span class="hl-5">implements</span><span class="hl-1"> </span><span class="hl-6">CardInterface</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">constructor</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-5">public</span><span class="hl-1"> </span><span class="hl-7">id</span><span class="hl-1">: </span><span class="hl-6">number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">public</span><span class="hl-1"> </span><span class="hl-7">name</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">public</span><span class="hl-1"> </span><span class="hl-7">manaCost</span><span class="hl-1">: </span><span class="hl-6">number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">public</span><span class="hl-1"> </span><span class="hl-7">color</span><span class="hl-1">: </span><span class="hl-6">Color</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">public</span><span class="hl-1"> </span><span class="hl-7">type</span><span class="hl-1">: </span><span class="hl-6">CardType</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">public</span><span class="hl-1"> </span><span class="hl-7">rarity</span><span class="hl-1">: </span><span class="hl-6">Rarity</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">public</span><span class="hl-1"> </span><span class="hl-7">rulesText</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">public</span><span class="hl-1"> </span><span class="hl-7">marketValue</span><span class="hl-1">: </span><span class="hl-6">number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">public</span><span class="hl-1"> </span><span class="hl-7">strengthResitance</span><span class="hl-1">?: </span><span class="hl-6">StrengthResistanceType</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">public</span><span class="hl-1"> </span><span class="hl-7">loyalty</span><span class="hl-1">?: </span><span class="hl-6">number</span><br/><span class="hl-1">  ) {}</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:card-utilities" class="tsd-anchor"></a><h3><a href="#md:card-utilities">Card utilities</a></h3><p>También se desarrollaron dos funciones para facilitar la impresión de la información de las cartas en el formato adecuado:</p>
<ul>
<li><code>colorString</code>:</li>
</ul>
<pre><code class="language-ts"><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">colorString</span><span class="hl-1">(</span><span class="hl-7">color</span><span class="hl-1">:</span><span class="hl-6">string</span><span class="hl-1">, </span><span class="hl-7">cadena</span><span class="hl-1">:</span><span class="hl-6">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">switch</span><span class="hl-1">(</span><span class="hl-7">color</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-2">&#39;white&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">white</span><span class="hl-1">(</span><span class="hl-7">cadena</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-2">&#39;blue&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">blue</span><span class="hl-1">(</span><span class="hl-7">cadena</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-2">&#39;black&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">black</span><span class="hl-1">(</span><span class="hl-7">cadena</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-2">&#39;red&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">red</span><span class="hl-1">(</span><span class="hl-7">cadena</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-2">&#39;green&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">green</span><span class="hl-1">(</span><span class="hl-7">cadena</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-2">&#39;colorless&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">white</span><span class="hl-1">(</span><span class="hl-7">cadena</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-2">&#39;multi&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">white</span><span class="hl-1">(</span><span class="hl-7">cadena</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">default</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">white</span><span class="hl-1">(</span><span class="hl-7">cadena</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<ul>
<li><code>printCard</code>:</li>
</ul>
<pre><code class="language-ts"><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">printCard</span><span class="hl-1">(</span><span class="hl-7">card</span><span class="hl-1">: </span><span class="hl-6">CardInterface</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-7">white</span><span class="hl-1">.</span><span class="hl-7">underline</span><span class="hl-1">.</span><span class="hl-0">bgBlack</span><span class="hl-1">(</span><span class="hl-2">&quot;Card Details&quot;</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Card ID: </span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">id</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Card Name: </span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">name</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Card Color: </span><span class="hl-5">${</span><span class="hl-0">colorString</span><span class="hl-8">(</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">color</span><span class="hl-8">, </span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">color</span><span class="hl-8">)</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Card Type: </span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">type</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Card Rarity: </span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">rarity</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Card Market Value: </span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">marketValue</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Card Rules Text: </span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">rulesText</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">if</span><span class="hl-1">(</span><span class="hl-7">card</span><span class="hl-1">.</span><span class="hl-7">strengthResitance</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Card Strength: </span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">strengthResitance</span><span class="hl-8">[</span><span class="hl-3">0</span><span class="hl-8">]</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Card Resistance: </span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">strengthResitance</span><span class="hl-8">[</span><span class="hl-3">1</span><span class="hl-8">]</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-4">if</span><span class="hl-1">(</span><span class="hl-7">card</span><span class="hl-1">.</span><span class="hl-7">loyalty</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Card Loyalty: </span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">loyalty</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;---------------------------------&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:collection" class="tsd-anchor"></a><h3><a href="#md:collection">Collection</a></h3><p>Se desarrolla una clase <code>Collection</code> con único atributo el path al directorio donde se almacenarán las colecciones. La clase presenta además cinco métodos que usan la API asíncrona de Node fs:</p>
<ul>
<li><code>add y addCard</code>:</li>
</ul>
<pre><code class="language-ts"><span class="hl-1">  </span><span class="hl-7">public</span><span class="hl-1"> </span><span class="hl-0">add</span><span class="hl-1">(</span><span class="hl-7">username</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-7">card</span><span class="hl-1">: </span><span class="hl-7">CardInterface</span><span class="hl-1">, </span><span class="hl-7">callback</span><span class="hl-1">: (</span><span class="hl-7">error</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1"> | </span><span class="hl-6">undefined</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1"> | </span><span class="hl-6">undefined</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">void</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">access</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-7">constants</span><span class="hl-1">.</span><span class="hl-9">F_OK</span><span class="hl-1">, (</span><span class="hl-7">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">err</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">mkdir</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, (</span><span class="hl-7">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-2">`Error creating the directory: </span><span class="hl-5">${</span><span class="hl-7">error</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">          } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-0">addCard</span><span class="hl-1">(</span><span class="hl-7">username</span><span class="hl-1">, </span><span class="hl-7">card</span><span class="hl-1">, </span><span class="hl-7">callback</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">      } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-0">addCard</span><span class="hl-1">(</span><span class="hl-7">username</span><span class="hl-1">, </span><span class="hl-7">card</span><span class="hl-1">, </span><span class="hl-7">callback</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-7">private</span><span class="hl-1"> </span><span class="hl-0">addCard</span><span class="hl-1">(</span><span class="hl-7">username</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-7">card</span><span class="hl-1">: </span><span class="hl-7">CardInterface</span><span class="hl-1">, </span><span class="hl-7">callback</span><span class="hl-1">: (</span><span class="hl-7">error</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1"> | </span><span class="hl-6">undefined</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1"> | </span><span class="hl-6">undefined</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">void</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">access</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">/</span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">id</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-7">constants</span><span class="hl-1">.</span><span class="hl-9">F_OK</span><span class="hl-1">, (</span><span class="hl-7">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">err</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">writeFile</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">/</span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">id</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-7">card</span><span class="hl-1">), (</span><span class="hl-7">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-2">`Error writing the file: </span><span class="hl-5">${</span><span class="hl-7">error</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">          } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-5">undefined</span><span class="hl-1">, </span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">green</span><span class="hl-1">(</span><span class="hl-2">`Card with id </span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">id</span><span class="hl-5">}</span><span class="hl-2"> added to collection`</span><span class="hl-1">));</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">      } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">red</span><span class="hl-1">(</span><span class="hl-2">`Card with id </span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">id</span><span class="hl-5">}</span><span class="hl-2"> already exists in collection`</span><span class="hl-1">), </span><span class="hl-5">undefined</span><span class="hl-1">)</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">  }</span>
</code><button>Copy</button></pre>
<p>  En primer lugar comprobamos si existe el directorio con el nombre del usuario (es decir, si existe el usuario), en caso de que no, se crea un directorio con el nombre del usuario y se comprueba si la carta ya existe antes de añadirla. Está dividida en dos partes para mayor simplicidad de lectura. Se hace uso de callbacks para retornar errores o información.</p>
<ul>
<li><code>modify</code>:</li>
</ul>
<pre><code class="language-ts"><span class="hl-7">public</span><span class="hl-1"> </span><span class="hl-0">modify</span><span class="hl-1">(</span><span class="hl-7">username</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-7">card</span><span class="hl-1">: </span><span class="hl-7">CardInterface</span><span class="hl-1">, </span><span class="hl-7">callback</span><span class="hl-1">: (</span><span class="hl-7">error</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1"> | </span><span class="hl-6">undefined</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1"> | </span><span class="hl-6">undefined</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">void</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">access</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-7">constants</span><span class="hl-1">.</span><span class="hl-9">F_OK</span><span class="hl-1">, (</span><span class="hl-7">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">red</span><span class="hl-1">(</span><span class="hl-2">`User </span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2"> does not exist.`</span><span class="hl-1">), </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">access</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">/</span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">id</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-7">constants</span><span class="hl-1">.</span><span class="hl-9">F_OK</span><span class="hl-1">, (</span><span class="hl-7">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">err</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">red</span><span class="hl-1">(</span><span class="hl-2">`Card with id </span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">id</span><span class="hl-5">}</span><span class="hl-2"> does not exist in collection`</span><span class="hl-1">), </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">writeFile</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">/</span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">id</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-7">card</span><span class="hl-1">), (</span><span class="hl-7">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-2">`Error writing the file: </span><span class="hl-5">${</span><span class="hl-7">error</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">            } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-5">undefined</span><span class="hl-1">, </span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">green</span><span class="hl-1">(</span><span class="hl-2">`Card with id </span><span class="hl-5">${</span><span class="hl-7">card</span><span class="hl-8">.</span><span class="hl-7">id</span><span class="hl-5">}</span><span class="hl-2"> modified`</span><span class="hl-1">));</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>  Primero comprobamos si existe el usuario y posteriormente si existe la carta, en caso de que si, se sobreescribe el fichero. Se hace uso de callbacks para retornar errores o información.</p>
<ul>
<li><code>remove</code>:</li>
</ul>
<pre><code class="language-ts"><span class="hl-7">public</span><span class="hl-1"> </span><span class="hl-0">remove</span><span class="hl-1">(</span><span class="hl-7">username</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-7">cardId</span><span class="hl-1">: </span><span class="hl-7">number</span><span class="hl-1">, </span><span class="hl-7">callback</span><span class="hl-1">: (</span><span class="hl-7">error</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1"> | </span><span class="hl-6">undefined</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1"> | </span><span class="hl-6">undefined</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">void</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">access</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-7">constants</span><span class="hl-1">.</span><span class="hl-9">F_OK</span><span class="hl-1">, (</span><span class="hl-7">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">red</span><span class="hl-1">(</span><span class="hl-2">`User </span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2"> does not exist.`</span><span class="hl-1">), </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">access</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">/</span><span class="hl-5">${</span><span class="hl-7">cardId</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-7">constants</span><span class="hl-1">.</span><span class="hl-9">F_OK</span><span class="hl-1">, (</span><span class="hl-7">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">err</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">red</span><span class="hl-1">(</span><span class="hl-2">`Card with id </span><span class="hl-5">${</span><span class="hl-7">cardId</span><span class="hl-5">}</span><span class="hl-2"> does not exist in collection`</span><span class="hl-1">), </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">unlink</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">/</span><span class="hl-5">${</span><span class="hl-7">cardId</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, (</span><span class="hl-7">error</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">red</span><span class="hl-1">(</span><span class="hl-2">`Error removing the file: </span><span class="hl-5">${</span><span class="hl-7">error</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">), </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">            } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-5">undefined</span><span class="hl-1">, </span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">green</span><span class="hl-1">(</span><span class="hl-2">`Card with id </span><span class="hl-5">${</span><span class="hl-7">cardId</span><span class="hl-5">}</span><span class="hl-2"> removed from collection`</span><span class="hl-1">));</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>  De forma similar a la anterior, comprobamos la existencia del usuario y carta, y la eliminamos, usando callbacks para el retorno de errores o información.</p>
<ul>
<li><code>list</code>:</li>
</ul>
<pre><code class="language-ts"><span class="hl-7">public</span><span class="hl-1"> </span><span class="hl-0">list</span><span class="hl-1">(</span><span class="hl-7">username</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-7">callback</span><span class="hl-1">: (</span><span class="hl-7">error</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1"> | </span><span class="hl-6">undefined</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1">[] | </span><span class="hl-6">undefined</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">void</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">access</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-7">constants</span><span class="hl-1">.</span><span class="hl-9">F_OK</span><span class="hl-1">, (</span><span class="hl-7">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">red</span><span class="hl-1">(</span><span class="hl-2">`User </span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2"> does not exist.`</span><span class="hl-1">), </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">readdir</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, (</span><span class="hl-7">error</span><span class="hl-1">, </span><span class="hl-7">files</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">red</span><span class="hl-1">(</span><span class="hl-2">`Error reading the directory: </span><span class="hl-5">${</span><span class="hl-7">error</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">), </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-9">fullContent</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1">[] = [];</span><br/><span class="hl-1">          </span><span class="hl-7">files</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">(</span><span class="hl-7">file</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">readFile</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">/</span><span class="hl-5">${</span><span class="hl-7">file</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, (</span><span class="hl-7">error</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">red</span><span class="hl-1">(</span><span class="hl-2">`Error reading the file: </span><span class="hl-5">${</span><span class="hl-7">error</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">), </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">              } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-7">fullContent</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-0">toString</span><span class="hl-1">());</span><br/><span class="hl-1">                </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">fullContent</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1"> === </span><span class="hl-7">files</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1">) {</span><br/><span class="hl-1">                  </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-5">undefined</span><span class="hl-1">, </span><span class="hl-7">fullContent</span><span class="hl-1">);</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">              }</span><br/><span class="hl-1">            });</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>  Realizamos las comprobaciones pertinentes y para listar todas las cartas primero cargamos todas las cartas de un usuario y luego mediante un forEach almacenamos la información de las cartas en un vector, cuando el vector tenga todas las cartas se llama al callback para retornar la información.</p>
<ul>
<li><code>read</code>:</li>
</ul>
<pre><code class="language-ts"><span class="hl-7">public</span><span class="hl-1"> </span><span class="hl-0">read</span><span class="hl-1">(</span><span class="hl-7">username</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-7">cardId</span><span class="hl-1">: </span><span class="hl-7">number</span><span class="hl-1">, </span><span class="hl-7">callback</span><span class="hl-1">: (</span><span class="hl-7">error</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1"> | </span><span class="hl-6">undefined</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1"> | </span><span class="hl-6">undefined</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">void</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">access</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-7">constants</span><span class="hl-1">.</span><span class="hl-9">F_OK</span><span class="hl-1">, (</span><span class="hl-7">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">red</span><span class="hl-1">(</span><span class="hl-2">`User </span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2"> does not exist.`</span><span class="hl-1">), </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">access</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">/</span><span class="hl-5">${</span><span class="hl-7">cardId</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-7">constants</span><span class="hl-1">.</span><span class="hl-9">F_OK</span><span class="hl-1">, (</span><span class="hl-7">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">err</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">red</span><span class="hl-1">(</span><span class="hl-2">`Card with id </span><span class="hl-5">${</span><span class="hl-7">cardId</span><span class="hl-5">}</span><span class="hl-2"> does not exist in collection`</span><span class="hl-1">), </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-7">fs</span><span class="hl-1">.</span><span class="hl-0">readFile</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-7">fullPath</span><span class="hl-1"> + </span><span class="hl-2">`/</span><span class="hl-5">${</span><span class="hl-7">username</span><span class="hl-5">}</span><span class="hl-2">/</span><span class="hl-5">${</span><span class="hl-7">cardId</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, (</span><span class="hl-7">error</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-7">chalk</span><span class="hl-1">.</span><span class="hl-0">red</span><span class="hl-1">(</span><span class="hl-2">`Error reading the file: </span><span class="hl-5">${</span><span class="hl-7">error</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">), </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">            } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-5">undefined</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-0">toString</span><span class="hl-1">());</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>  Para leer una carta, realizamos las correspondientes comprobaciones y devolvemos la información.</p>
<p>Podemos comprobar que en cada caso los mensajes por la consola se pasan en color verde, y los de error en color rojo.</p>
<a id="md:intérprete-de-línea-de-comandos-en-clientts" class="tsd-anchor"></a><h3><a href="#md:intérprete-de-línea-de-comandos-en-clientts">Intérprete de línea de comandos en client.ts</a></h3><p>En el archivo client.ts se ha implementado toda la funcionalidad para poder leer comandos desde la línea de comandos y realizar enviar los datos al servidor. También se puede apreciar como se recibe el mensaje de vuelta del servidor y las acciones que se realizan con este. A continuación se muestra el ejemplo para el método add:</p>
<pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-9">client</span><span class="hl-1"> = </span><span class="hl-7">net</span><span class="hl-1">.</span><span class="hl-0">connect</span><span class="hl-1">({ </span><span class="hl-7">port:</span><span class="hl-1"> </span><span class="hl-3">60300</span><span class="hl-1"> });</span><br/><br/><span class="hl-0">yargs</span><span class="hl-1">(</span><span class="hl-0">hideBin</span><span class="hl-1">(</span><span class="hl-7">process</span><span class="hl-1">.</span><span class="hl-7">argv</span><span class="hl-1">))</span><br/><span class="hl-1">.</span><span class="hl-0">command</span><span class="hl-1">(</span><span class="hl-2">&#39;add&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;Adds a card to the collection&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-7">username:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">description:</span><span class="hl-1"> </span><span class="hl-2">&#39;The username of the collection owner&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">demandOption:</span><span class="hl-1"> </span><span class="hl-5">true</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-7">id:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">description:</span><span class="hl-1"> </span><span class="hl-2">&#39;The ID of the card to add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;number&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">demandOption:</span><span class="hl-1"> </span><span class="hl-5">true</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-7">name:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">description:</span><span class="hl-1"> </span><span class="hl-2">&#39;The name of the card to add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">demandOption:</span><span class="hl-1"> </span><span class="hl-5">true</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-7">manaCost:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">description:</span><span class="hl-1"> </span><span class="hl-2">&#39;The mana cost of the card to add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;number&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">demandOption:</span><span class="hl-1"> </span><span class="hl-5">true</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-7">color:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">description:</span><span class="hl-1"> </span><span class="hl-2">&#39;The color of the card to add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">demandOption:</span><span class="hl-1"> </span><span class="hl-5">true</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-7">type:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">description:</span><span class="hl-1"> </span><span class="hl-2">&#39;The type of the card to add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">demandOption:</span><span class="hl-1"> </span><span class="hl-5">true</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-7">rarity:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">description:</span><span class="hl-1"> </span><span class="hl-2">&#39;The rarity of the card to add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">demandOption:</span><span class="hl-1"> </span><span class="hl-5">true</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-7">rulesText:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">description:</span><span class="hl-1"> </span><span class="hl-2">&#39;The rules text of the card to add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">demandOption:</span><span class="hl-1"> </span><span class="hl-5">true</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-7">marketValue:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">description:</span><span class="hl-1"> </span><span class="hl-2">&#39;The market value of the card to add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;number&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">demandOption:</span><span class="hl-1"> </span><span class="hl-5">true</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-7">strength:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">description:</span><span class="hl-1"> </span><span class="hl-2">&#39;The strength of the card to add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;number&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">demandOption:</span><span class="hl-1"> </span><span class="hl-5">false</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-7">resistance:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">description:</span><span class="hl-1"> </span><span class="hl-2">&#39;The resistance of the card to add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;number&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">demandOption:</span><span class="hl-1"> </span><span class="hl-5">false</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-7">loyalty:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">description:</span><span class="hl-1"> </span><span class="hl-2">&#39;The loyalty of the card to add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;number&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">demandOption:</span><span class="hl-1"> </span><span class="hl-5">false</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }, (</span><span class="hl-7">argv</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-9">message</span><span class="hl-1"> = </span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-7">action:</span><span class="hl-1"> </span><span class="hl-2">&#39;add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">user:</span><span class="hl-1"> </span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">username</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">card:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">id:</span><span class="hl-1"> </span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">id</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">name:</span><span class="hl-1"> </span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">name</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">manaCost:</span><span class="hl-1"> </span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">manaCost</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">color:</span><span class="hl-1"> </span><span class="hl-7">Color</span><span class="hl-1">[</span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">color</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-5">keyof</span><span class="hl-1"> </span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-7">Color</span><span class="hl-1">],</span><br/><span class="hl-1">        </span><span class="hl-7">type:</span><span class="hl-1"> </span><span class="hl-7">CardType</span><span class="hl-1">[</span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">type</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-5">keyof</span><span class="hl-1"> </span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-7">CardType</span><span class="hl-1">],</span><br/><span class="hl-1">        </span><span class="hl-7">rarity:</span><span class="hl-1"> </span><span class="hl-7">Rarity</span><span class="hl-1">[</span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">rarity</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> </span><span class="hl-5">keyof</span><span class="hl-1"> </span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-7">Rarity</span><span class="hl-1">],</span><br/><span class="hl-1">        </span><span class="hl-7">rulesText:</span><span class="hl-1"> </span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">rulesText</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">marketValue:</span><span class="hl-1"> </span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">marketValue</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">strengthResitance:</span><span class="hl-1"> </span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">strength</span><span class="hl-1"> &amp;&amp; </span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">resistance</span><span class="hl-1"> ? [</span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">strength</span><span class="hl-1">, </span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">resistance</span><span class="hl-1">] : </span><span class="hl-5">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">loyalty:</span><span class="hl-1"> </span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">loyalty</span><span class="hl-1"> ? </span><span class="hl-7">argv</span><span class="hl-1">.</span><span class="hl-7">loyalty</span><span class="hl-1"> : </span><span class="hl-5">undefined</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-7">closed:</span><span class="hl-1"> </span><span class="hl-2">&#39;DONE&#39;</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-7">client</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-7">message</span><span class="hl-1">);</span><br/><span class="hl-1">  }).</span><span class="hl-0">help</span><span class="hl-1">().</span><span class="hl-7">argv</span><span class="hl-1">;</span><br/><br/><br/><span class="hl-5">let</span><span class="hl-1"> </span><span class="hl-7">wholeData</span><span class="hl-1"> = </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-7">client</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-7">dataChunk</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">wholeData</span><span class="hl-1"> += </span><span class="hl-7">dataChunk</span><span class="hl-1">;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">client</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;end&#39;</span><span class="hl-1">, () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-9">message</span><span class="hl-1"> = </span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-7">wholeData</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">message</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1"> === </span><span class="hl-2">&#39;CardCollection&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-9">cards</span><span class="hl-1"> = </span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-7">message</span><span class="hl-1">.</span><span class="hl-7">answer</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">cards</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-7">card</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">printCard</span><span class="hl-1">(</span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-7">card</span><span class="hl-1">));</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  } </span><span class="hl-4">else</span><span class="hl-1"> </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">message</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1"> === </span><span class="hl-2">&#39;SingleCard&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-9">card</span><span class="hl-1"> = </span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-7">message</span><span class="hl-1">.</span><span class="hl-7">answer</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">printCard</span><span class="hl-1">(</span><span class="hl-7">card</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-7">message</span><span class="hl-1">.</span><span class="hl-7">answer</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>En primer lugar creamos el socket <code>cliente</code> para conectarnos al servidor, luego obtenemos los parametros por linea de comandos, y creamos el mensaje que se va a mandar al servidor. Cabe destacar el atributo <code>closed</code> que se usará en el servidor para comprobar si se ha recibido todo el mensaje.</p>
<p>Como el servidor cierra la conexión justo después de enviar el mensaje, aprovechamos el evento <code>end</code> para saber que ya se ha recibido todo el mensaje (mientras tanto, se recoge toda la información recibida mediante el evento <code>data</code>). Una vez recibido, se comprueba el estatus, que permite saber si hemos recibido una sola carta o una colección entera y la imprimimos. Si no es alguna de estas dos (el ultimo else), se trata de un mensaje de exito o error que, como el metodo en <code>Collections</code> le asigna el chalk, lo imprimimos directamente.</p>
<p>Para el resto de comandos la estructura es la misma, cambiando para cada caso, el método llamado y los comandos que se piden.</p>
<a id="md:clase-requesteventemitter-para-el-servidor" class="tsd-anchor"></a><h3><a href="#md:clase-requesteventemitter-para-el-servidor">Clase RequestEventEmitter para el servidor</a></h3><p>Se crea una clase <code>RequestEventEmitter</code> que hereda de <code>EventEmitter</code> y se encarga de cerciorarse de que se ha recibido todo el mensaje enviado desde el cliente y posteriormente emite un evento <code>request</code> junto con el mensaje para notificar al servidor.</p>
<pre><code class="language-ts"><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-5">class</span><span class="hl-1"> </span><span class="hl-6">RequestEventEmitter</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-6">EventEmitter</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">constructor</span><span class="hl-1">(</span><span class="hl-7">connection</span><span class="hl-1">: </span><span class="hl-6">EventEmitter</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">super</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-5">let</span><span class="hl-1"> </span><span class="hl-7">socketData</span><span class="hl-1"> = </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-7">dataChunk</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">socketData</span><span class="hl-1"> += </span><span class="hl-7">dataChunk</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-7">socketData</span><span class="hl-1">.</span><span class="hl-0">includes</span><span class="hl-1">(</span><span class="hl-2">&#39;DONE&#39;</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-0">emit</span><span class="hl-1">(</span><span class="hl-2">&#39;request&#39;</span><span class="hl-1">, </span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-7">socketData</span><span class="hl-1">), </span><span class="hl-7">connection</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:servidor" class="tsd-anchor"></a><h3><a href="#md:servidor">Servidor</a></h3><p>El servidor recibe la petición del cliente y mmediante un switch, realiza una de las 5 acciones posibles sobre la colección. Además, recibe la información de los callback de los métodos de la clase <code>Collection</code> y construye un mensaje que es devuelto al cliente.</p>
<pre><code class="language-ts"><span class="hl-7">net</span><span class="hl-1">.</span><span class="hl-0">createServer</span><span class="hl-1">((</span><span class="hl-7">connection</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;A client has connected.&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-9">client</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">RequestEventEmitter</span><span class="hl-1">(</span><span class="hl-7">connection</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;close&#39;</span><span class="hl-1">, () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;A client has disconnected.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-7">client</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;request&#39;</span><span class="hl-1">, (</span><span class="hl-7">request</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Request recieved (</span><span class="hl-5">${</span><span class="hl-7">request</span><span class="hl-8">.</span><span class="hl-7">action</span><span class="hl-5">}</span><span class="hl-2">)`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-9">collection</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Collection</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">switch</span><span class="hl-1">(</span><span class="hl-7">request</span><span class="hl-1">.</span><span class="hl-7">action</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-2">&#39;add&#39;</span><span class="hl-1">: {</span><br/><span class="hl-1">        </span><span class="hl-7">collection</span><span class="hl-1">.</span><span class="hl-0">add</span><span class="hl-1">(</span><span class="hl-7">request</span><span class="hl-1">.</span><span class="hl-7">user</span><span class="hl-1">, </span><span class="hl-7">request</span><span class="hl-1">.</span><span class="hl-7">card</span><span class="hl-1">, (</span><span class="hl-7">error</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">if</span><span class="hl-1">(</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">({ </span><span class="hl-7">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;error&#39;</span><span class="hl-1">, </span><span class="hl-7">answer:</span><span class="hl-1"> </span><span class="hl-7">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">          } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">({ </span><span class="hl-7">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;success&#39;</span><span class="hl-1">, </span><span class="hl-7">answer:</span><span class="hl-1"> </span><span class="hl-7">data</span><span class="hl-1"> }));</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">();</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-4">break</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-2">&#39;modify&#39;</span><span class="hl-1">: {</span><br/><span class="hl-1">        </span><span class="hl-7">collection</span><span class="hl-1">.</span><span class="hl-0">modify</span><span class="hl-1">(</span><span class="hl-7">request</span><span class="hl-1">.</span><span class="hl-7">user</span><span class="hl-1">, </span><span class="hl-7">request</span><span class="hl-1">.</span><span class="hl-7">card</span><span class="hl-1">, (</span><span class="hl-7">error</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">if</span><span class="hl-1">(</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">({ </span><span class="hl-7">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;error&#39;</span><span class="hl-1">, </span><span class="hl-7">answer:</span><span class="hl-1"> </span><span class="hl-7">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">          } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">({ </span><span class="hl-7">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;success&#39;</span><span class="hl-1">, </span><span class="hl-7">answer:</span><span class="hl-1"> </span><span class="hl-7">data</span><span class="hl-1"> }));</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">();</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-4">break</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-2">&#39;remove&#39;</span><span class="hl-1">: {</span><br/><span class="hl-1">        </span><span class="hl-7">collection</span><span class="hl-1">.</span><span class="hl-0">remove</span><span class="hl-1">(</span><span class="hl-7">request</span><span class="hl-1">.</span><span class="hl-7">user</span><span class="hl-1">, </span><span class="hl-7">request</span><span class="hl-1">.</span><span class="hl-7">cardId</span><span class="hl-1">, (</span><span class="hl-7">error</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">if</span><span class="hl-1">(</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">({ </span><span class="hl-7">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;error&#39;</span><span class="hl-1">, </span><span class="hl-7">answer:</span><span class="hl-1"> </span><span class="hl-7">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">          } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">({ </span><span class="hl-7">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;success&#39;</span><span class="hl-1">, </span><span class="hl-7">answer:</span><span class="hl-1"> </span><span class="hl-7">data</span><span class="hl-1"> }));</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">();</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-4">break</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-2">&#39;list&#39;</span><span class="hl-1">: {</span><br/><span class="hl-1">        </span><span class="hl-7">collection</span><span class="hl-1">.</span><span class="hl-0">list</span><span class="hl-1">(</span><span class="hl-7">request</span><span class="hl-1">.</span><span class="hl-7">user</span><span class="hl-1">, (</span><span class="hl-7">error</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">if</span><span class="hl-1">(</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">({ </span><span class="hl-7">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;error&#39;</span><span class="hl-1">, </span><span class="hl-7">answer:</span><span class="hl-1"> </span><span class="hl-7">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">          } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">({ </span><span class="hl-7">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;CardCollection&#39;</span><span class="hl-1">, </span><span class="hl-7">answer:</span><span class="hl-1"> </span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-7">data</span><span class="hl-1">) }));</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">();</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-4">break</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-4">case</span><span class="hl-1"> </span><span class="hl-2">`read`</span><span class="hl-1">: {</span><br/><span class="hl-1">        </span><span class="hl-7">collection</span><span class="hl-1">.</span><span class="hl-0">read</span><span class="hl-1">(</span><span class="hl-7">request</span><span class="hl-1">.</span><span class="hl-7">user</span><span class="hl-1">, </span><span class="hl-7">request</span><span class="hl-1">.</span><span class="hl-7">cardId</span><span class="hl-1">, (</span><span class="hl-7">error</span><span class="hl-1">, </span><span class="hl-7">data</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">if</span><span class="hl-1">(</span><span class="hl-7">error</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">({ </span><span class="hl-7">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;error&#39;</span><span class="hl-1">, </span><span class="hl-7">answer:</span><span class="hl-1"> </span><span class="hl-7">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">          } </span><span class="hl-4">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">({ </span><span class="hl-7">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;SingleCard&#39;</span><span class="hl-1">, </span><span class="hl-7">answer:</span><span class="hl-1"> </span><span class="hl-7">data</span><span class="hl-1"> }));</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-7">connection</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">();</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-4">break</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-4">default</span><span class="hl-1">: {</span><br/><span class="hl-1">        </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Invalid action&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  })</span><br/><br/><span class="hl-1">}).</span><span class="hl-0">listen</span><span class="hl-1">(</span><span class="hl-3">60300</span><span class="hl-1">, () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Waiting for clients to connect...&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Se puede apreciar como se usa la clase <code>RequestEventEmitter</code> y luego se actua sobre el evento <code>request</code>. El mensaje que es devuelto al cliente tiene un atributo <code>status</code> que le indica que tipo de mensaje es (un mensaje informativo de error o exito, la informacion de una unica carta o la informacion de una coleccion entera). Inmediatamente después de devolver el mensaje se cierra la conexion con el cliente.</p>
<a id="md:ejercicio-de-pe" class="tsd-anchor"></a><h2><a href="#md:ejercicio-de-pe">Ejercicio de pe</a></h2><a id="md:descripción-del-ejercicio" class="tsd-anchor"></a><h3><a href="#md:descripción-del-ejercicio">Descripción del ejercicio</a></h3><p>Durante la práctica 9, debería haber escrito métodos para añadir, modificar, borrar y actualizar la información de una carta de la colección de un usuario. Escoja alguna de esas funciones e impleméntela siguiendo el patrón callback.</p>
<p>Luego, sustituya la invocación de métodos del API síncrona de Node.js de gestión el sistema de ficheros, por llamadas a los métodos equivalentes del API asíncrona basada en callback.</p>
<a id="md:solución-implementada" class="tsd-anchor"></a><h3><a href="#md:solución-implementada">Solución implementada</a></h3><p>La solución propuesta la podemos ver en el método <code>add</code>descrito más arriba.</p>
<a id="md:💭conclusiones" class="tsd-anchor"></a><h2><a href="#md:💭conclusiones">💭Conclusiones</a></h2><p>En el desarrollo de esta práctica hemos aplicado la técnica cliente-servidor, aplicandola sobre una práctica preexistente.</p>
<a id="md:🔗bibliografía" class="tsd-anchor"></a><h2><a href="#md:🔗bibliografía">🔗Bibliografía</a></h2><p><a href="https://ull-esit-inf-dsi-2324.github.io/prct10-fs-proc-sockets-magic-app/">Guión de práctica 10</a></p>
<a id="md:🛠️herramientas" class="tsd-anchor"></a><h2><a href="#md:🛠️herramientas">🛠️Herramientas</a></h2><p>Algunas de las herramientas que se han utilizado en esta práctica son las siguientes:</p>
<p><img src="https://img.shields.io/badge/GitHub-100000?style=for-the-badge&logo=github&logoColor=white" /> <img src="https://img.shields.io/badge/GitHub%20Pages-222222?style=for-the-badge&logo=GitHub%20Pages&logoColor=white"/>  <img src="https://img.shields.io/badge/Github%20Actions-282a2e?style=for-the-badge&logo=githubactions&logoColor=367cfe"/> <img src="https://img.shields.io/badge/eslint-3A33D1?style=for-the-badge&logo=eslint&logoColor=white"/> <img src="https://img.shields.io/badge/prettier-1A2C34?style=for-the-badge&logo=prettier&logoColor=F7BA3E"/> <img src="https://img.shields.io/badge/TypeScript-007ACC?style=for-the-badge&logo=typescript&logoColor=white"/> <img src="https://img.shields.io/badge/npm-CB3837?style=for-the-badge&logo=npm&logoColor=white"/> <img src="https://img.shields.io/badge/Node%20js-339933?style=for-the-badge&logo=nodedotjs&logoColor=white"/> <img src="https://img.shields.io/badge/Mocha-8D6748?style=for-the-badge&logo=Mocha&logoColor=white"/> <img src="https://img.shields.io/badge/chai-A30701?style=for-the-badge&logo=chai&logoColor=white"/></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:práctica-10---aplicación-cliente-servidor-para-coleccionistas-de-cartas-magic"><span>Práctica 10 -<wbr/> <wbr/>Aplicación cliente-<wbr/>servidor para coleccionistas de cartas <wbr/>Magic</span></a><ul><li><a href="#md:🌳-estructura-del-repositorio"><span>🌳 <wbr/>Estructura del repositorio</span></a></li><li><a href="#md:📚introducción"><span>📚<wbr/>Introducción</span></a></li><li><a href="#md:📋tareas-previas"><span>📋<wbr/>Tareas <wbr/>Previas</span></a></li><li><a href="#md:enunciado"><span>Enunciado</span></a></li><li><a href="#md:implementación"><span>Implementación</span></a></li><li><ul><li><a href="#md:implementación-card"><span>Implementación <wbr/>Card</span></a></li><li><a href="#md:card-utilities"><span>Card utilities</span></a></li><li><a href="#md:collection"><span>Collection</span></a></li><li><a href="#md:intérprete-de-línea-de-comandos-en-clientts"><span>Intérprete de línea de comandos en client.ts</span></a></li><li><a href="#md:clase-requesteventemitter-para-el-servidor"><span>Clase <wbr/>Request<wbr/>Event<wbr/>Emitter para el servidor</span></a></li><li><a href="#md:servidor"><span>Servidor</span></a></li></ul></li><li><a href="#md:ejercicio-de-pe"><span>Ejercicio de pe</span></a></li><li><ul><li><a href="#md:descripción-del-ejercicio"><span>Descripción del ejercicio</span></a></li><li><a href="#md:solución-implementada"><span>Solución implementada</span></a></li></ul></li><li><a href="#md:💭conclusiones"><span>💭<wbr/>Conclusiones</span></a></li><li><a href="#md:🔗bibliografía"><span>🔗<wbr/>Bibliografía</span></a></li><li><a href="#md:🛠️herramientas"><span>🛠️<wbr/>Herramientas</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>DSI - Group R</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><div class="tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div></body></html>